
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Health Analytics Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üè• Patient Health Analytics Dashboard</h1>
            <div class="status">
                <div class="status-dot"></div>
                <span>API Connected</span>
            </div>
        </header>

        <!-- Dashboard Cards -->
        <div class="dashboard">
            <!-- Patient Count Card -->
            <div class="card">
                <h2>Total Patients</h2>
                <div class="card-description" id="count-desc">Loading...</div>
                <div class="query-info" id="count-query">Running query...</div>
                <div class="data-content">
                    <div class="big-number" id="count-data">-</div>
                </div>
                <div class="timestamp" id="count-time"></div>
            </div>

            <!-- Patient Conditions Analytics Card -->
            <div class="card">
                <h2>Conditions by Patient Count</h2>
                <div class="card-description" id="conditions-desc">Loading...</div>
                <div class="query-info" id="conditions-query">Running query...</div>
                <div class="data-content" id="conditions-data">Loading...</div>
                <div class="timestamp" id="conditions-time"></div>
            </div>
        </div>

        <!-- All Patients Table -->
        <div class="card">
            <h2>All Patients</h2>
            <div class="card-description" id="patients-desc">Loading...</div>
            <div class="query-info" id="patients-query">Running query...</div>
            <div class="data-content" id="patients-data">Loading...</div>
            <div class="timestamp" id="patients-time"></div>
        </div>

        <!-- All Conditions Table -->
        <div class="card">
            <h2>All Conditions</h2>
            <div class="card-description" id="all-conditions-desc">Loading...</div>
            <div class="query-info" id="all-conditions-query">Running query...</div>
            <div class="data-content" id="all-conditions-data">Loading...</div>
            <div class="timestamp" id="all-conditions-time"></div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        // Fetch and display patient count
        fetch(`${API_BASE}/patients/count`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('count-data').textContent = data.data;
                document.getElementById('count-desc').textContent = data.description;
                document.getElementById('count-query').textContent = data.query;
                document.getElementById('count-time').textContent = `Updated: ${new Date(data.timestamp).toLocaleString()}`;
            })
            .catch(err => {
                document.getElementById('count-data').innerHTML = `<div class="error">Error: ${err.message}</div>`;
            });

        // Fetch and display all patients
        fetch(`${API_BASE}/patients`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('patients-desc').textContent = data.description;
                document.getElementById('patients-query').textContent = data.query;
                document.getElementById('patients-time').textContent = `Updated: ${new Date(data.timestamp).toLocaleString()}`;
                
                let html = `<table>
                    <tr>
                        <th>ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Date of Birth</th>
                        <th>Email</th>
                    </tr>`;
                
                data.data.forEach(patient => {
                    html += `<tr>
                        <td>${patient.id}</td>
                        <td>${patient.first_name}</td>
                        <td>${patient.last_name}</td>
                        <td>${patient.date_of_birth}</td>
                        <td>${patient.email}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('patients-data').innerHTML = html;
            })
            .catch(err => {
                document.getElementById('patients-data').innerHTML = `<div class="error">Error: ${err.message}</div>`;
            });

        // Fetch and display all conditions
        fetch(`${API_BASE}/conditions`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('all-conditions-desc').textContent = data.description;
                document.getElementById('all-conditions-query').textContent = data.query;
                document.getElementById('all-conditions-time').textContent = `Updated: ${new Date(data.timestamp).toLocaleString()}`;
                
                let html = `<table>
                    <tr>
                        <th>ID</th>
                        <th>Condition Name</th>
                        <th>Description</th>
                        <th>Severity</th>
                    </tr>`;
                
                data.data.forEach(condition => {
                    html += `<tr>
                        <td>${condition.id}</td>
                        <td>${condition.name}</td>
                        <td>${condition.description}</td>
                        <td>${condition.severity}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('all-conditions-data').innerHTML = html;
            })
            .catch(err => {
                document.getElementById('all-conditions-data').innerHTML = `<div class="error">Error: ${err.message}</div>`;
            });

        // Fetch and display patient conditions analytics
        fetch(`${API_BASE}/analytics/patient-conditions`)
            .then(res => res.json())
            .then(data => {
                document.getElementById('conditions-desc').textContent = data.description;
                document.getElementById('conditions-query').textContent = data.query;
                document.getElementById('conditions-time').textContent = `Updated: ${new Date(data.timestamp).toLocaleString()}`;
                
                let html = `<table>
                    <tr>
                        <th>Condition</th>
                        <th>Patient Count</th>
                    </tr>`;
                
                data.data.forEach(item => {
                    html += `<tr>
                        <td>${item.condition}</td>
                        <td>${item.patient_count}</td>
                    </tr>`;
                });
                
                html += '</table>';
                document.getElementById('conditions-data').innerHTML = html;
            })
            .catch(err => {
                document.getElementById('conditions-data').innerHTML = `<div class="error">Error: ${err.message}</div>`;
            });
    </script>
</body>
</html>